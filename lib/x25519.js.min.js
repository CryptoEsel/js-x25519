"use strict";var _createClass=function(){function r(r,a){for(var e=0;e<a.length;e++){var n=a[e];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(r,n.key,n)}}return function(a,e,n){return e&&r(a.prototype,e),n&&r(a,n),a}}();function _classCallCheck(r,a){if(!(r instanceof a))throw new TypeError("Cannot call a class as a function")}var _X25519_ZERO=new Float64Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),_X25519_ONE=new Float64Array([1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]),_X25519_NINE=new Uint8Array(32),_X25519_121665=new Float64Array([56129,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);_X25519_NINE[0]=9;var X25519=function(){function r(){_classCallCheck(this,r)}return _createClass(r,null,[{key:"getPublic",value:function(a){if(32!==a.byteLength)throw new Error("Secret wrong length, should be 32 bytes.");var e=new Uint8Array(a);return r.clamp(e),r._scalarMul(e,_X25519_NINE)}},{key:"getSharedKey",value:function(a,e){if(32!==a.byteLength||32!==e.byteLength)throw new Error("Secret key or public key wrong length, should be 32 bytes.");var n=new Uint8Array(a);return r.clamp(n),r._scalarMul(n,e)}},{key:"_add",value:function(r,a,e){for(var n=0;n<16;n++)r[n]=a[n]+e[n]|0}},{key:"_sub",value:function(r,a,e){for(var n=0;n<16;n++)r[n]=a[n]-e[n]|0}},{key:"_mul",value:function(a,e,n){var _=0,l=0,o=new Float64Array(31);for(_=0;_<16;_++)for(l=0;l<16;l++)o[_+l]+=e[_]*n[l];for(_=0;_<15;_++)o[_]+=38*o[_+16];r._car25519(o),r._car25519(o),r._copy(a,o)}},{key:"_sqr",value:function(a,e){r._mul(a,e,e)}},{key:"_scalarMul",value:function(a,e){var n=new Float64Array(80),_=new Float64Array(_X25519_ONE),l=new Float64Array(_X25519_ZERO),o=new Float64Array(_X25519_ZERO),t=new Float64Array(_X25519_ONE),u=new Float64Array(_X25519_ZERO),c=new Float64Array(_X25519_ZERO),y=new Uint8Array(a),f=0;r._unpack(n,e),r._copy(l,n);for(var s=254;s>=0;--s)f=y[s>>>3]>>>(7&s)&1,r._sel25519(_,l,f),r._sel25519(o,t,f),r._add(u,_,o),r._sub(_,_,o),r._add(o,l,t),r._sub(l,l,t),r._sqr(t,u),r._sqr(c,_),r._mul(_,o,_),r._mul(o,l,u),r._add(u,_,o),r._sub(_,_,o),r._sqr(l,_),r._sub(o,t,c),r._mul(_,o,_X25519_121665),r._add(_,_,t),r._mul(o,o,_),r._mul(_,t,c),r._mul(t,l,n),r._sqr(l,u),r._sel25519(_,l,f),r._sel25519(o,t,f);for(var i=0;i<16;i++)n[i+16]=_[i],n[i+32]=o[i],n[i+48]=l[i],n[i+64]=t[i];var v=n.subarray(32),w=n.subarray(16);r._inv25519(v,v),r._mul(w,w,v);var k=new Uint8Array(32);return r._pack(k,w),k}},{key:"_inv25519",value:function(a,e){var n=new Float64Array(16);r._copy(n,e);for(var _=253;_>=0;_--)r._sqr(n,n),2!==_&&4!==_&&r._mul(n,n,e);r._copy(a,n)}},{key:"_sel25519",value:function(r,a,e){for(var n=0,_=~(e-1),l=0;l<16;l++)n=_&(r[l]^a[l]),r[l]^=n,a[l]^=n}},{key:"_car25519",value:function(r){for(var a=0,e=0;e<16;e++)r[e]+=65536,a=Math.floor(r[e]/65536),r[(e+1)*(e<15?1:0)]+=a-1+37*(a-1)*(15===e?1:0),r[e]-=65536*a}},{key:"_unpack",value:function(r,a){for(var e=0;e<16;e++)r[e]=a[2*e]+(a[2*e+1]<<8)}},{key:"_pack",value:function(a,e){var n=new Float64Array(16),_=new Float64Array(16),l=0,o=0;r._copy(_,e),r._car25519(_),r._car25519(_),r._car25519(_);for(var t=0;t<2;t++){for(n[0]=_[0]-65517,l=1;l<15;l++)n[l]=_[l]-65535-(n[l-1]>>16&1),n[l-1]&=65535;n[15]=_[15]-32767-(n[14]>>16&1),o=n[15]>>16&1,n[14]&=65535,r._sel25519(_,n,1-o)}for(l=0;l<16;l++)a[2*l]=255&_[l],a[2*l+1]=_[l]>>8}},{key:"_copy",value:function(r,a){for(var e=a.length,n=0;n<e;n++)r[n]=a[n]}},{key:"clamp",value:function(r){r[0]=248&r[0],r[31]=127&r[31]|64}}]),r}();"undefined"!=typeof module&&(module.exports=X25519);
